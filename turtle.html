<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Turtle</title>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/fabric.js/1.3.0/fabric.min.js"></script>


    <style type="text/css">

        #c {
            background-color: #eeeeee;
        }

    </style>

    <script type="text/javascript">

        function Player (x, y, width, height, canvas) 
        {
            this.x = x;
            this.y = y;
            this.xOrig = x;
            this.yOrig = y;
            this.width = width;
            this.height = height;
            this.angle = 0;
            this.color = 'red';
            this.speed = 2;
            this.turningSpeed = 5;
            this.fabricTriangle = null;
            this.canvas = canvas;
            this.path = [['M', this.x, this.y]];
            this.fabricPath = null;
            this.draw = function() 
            {
                this.canvas.remove(this.fabricTriangle);
                this.fabricTriangle = new fabric.Triangle({
                    left: this.x,
                    top: this.y,
                    angle: this.angle,
                    fill: this.color,
                    width:this.width,
                    height:this.height
                });
                this.canvas.add(this.fabricTriangle);
                
                this.canvas.remove(this.fabricPath);           
                this.fabricPath = new fabric.Path(this.path);
                this.fabricPath.set({stroke: this.color, fill:'none'});
                this.canvas.add(this.fabricPath);
            };
            this.turnRight = function() 
            {
                this.angle += this.turningSpeed;
            }
            this.turnLeft = function() 
            {
                this.angle -= this.turningSpeed;
            }
            this.move = function() 
            {                
                this.path.push(['L', this.x, this.y]);
                this.y -= this.speed*Math.sin(this.angle*Math.PI/180+Math.PI/2); 
                this.x -= this.speed*Math.cos(this.angle*Math.PI/180+Math.PI/2);
            }
            this.reset = function() 
            {
                this.x = this.xOrig;
                this.y = this.yOrig;
                this.path = [['M', this.x, this.y]];
                this.angle = 0;
            }
        }

        function main() 
        {
            if (keyboardState.rightDown) {
                player.turnRight();
            }
            if (keyboardState.leftDown) {
                player.turnLeft();
            }
            if (keyboardState.upDown) {
                player.move();
            }
            player.draw(canvas);
        }

        var canvas;
        var player;
        var keyboardState = new Object();
        keyboardState.leftDown = false;
        keyboardState.rightDown = false;
        keyboardState.upDown = false;

        $(document).ready(function() 
        {
            canvas = new fabric.StaticCanvas('c');
            player = new Player(400,300,20,20, canvas);

            setInterval(main, 20);
        });

        $(document).keydown(function(event) 
        {
            if (event.which == 38) {
                // move
                keyboardState.upDown = true;
            }
            else if (event.which == 39) {
                //right
                keyboardState.rightDown = true;
            }
            else if (event.which == 37) {
                //left
                keyboardState.leftDown = true;
            }
        });

        $(document).keyup(function(event) 
        {
            if (event.which == 38) {
                // move
                keyboardState.upDown = false;
            }
            else if (event.which == 39) {
                //right
                keyboardState.rightDown = false;
            }
            else if (event.which == 37) {
                //left
                keyboardState.leftDown = false;
            }
        });

        $(function() {
            $("#reset").click(function() 
            {
                player.reset();            
            });
        });

    </script>

</head>
<body>

    <canvas id="c" width="800" height="600"></canvas>

    <input id="reset" type="submit" value="reset" />

</body>
</html>